# iOS æ—¥æœŸå…¼å®¹æ€§ä¿®å¤æ€»ç»“

## ğŸ”§ å·²ä¿®å¤çš„é—®é¢˜

### 1. æ ¸å¿ƒæ—¥æœŸå¤„ç†å‡½æ•°
æ·»åŠ äº†ä¸¤ä¸ªå®‰å…¨çš„æ—¥æœŸåˆ›å»ºå‡½æ•°ï¼š

```javascript
// å®‰å…¨åˆ›å»ºå½“å‰æ—¥æœŸå¯¹è±¡
createCurrentDate() {
    return new Date();
}

// å®‰å…¨åˆ›å»ºæ—¥æœŸå¯¹è±¡ï¼Œé¿å…iOSå…¼å®¹æ€§é—®é¢˜
createSafeDate(input) {
    if (!input) return this.createCurrentDate();
    
    // å¦‚æœæ˜¯æ•°å­—æ—¶é—´æˆ³ï¼Œç›´æ¥ä½¿ç”¨
    if (typeof input === 'number') {
        return new Date(input);
    }
    
    // å¦‚æœæ˜¯Dateå¯¹è±¡ï¼Œç›´æ¥è¿”å›
    if (input instanceof Date) {
        return input;
    }
    
    // å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œä½¿ç”¨parseDateæ–¹æ³•å®‰å…¨è§£æ
    if (typeof input === 'string') {
        return this.parseDate(input) || this.createCurrentDate();
    }
    
    return this.createCurrentDate();
}
```

### 2. å·²ä¿®å¤çš„æ–¹æ³•åˆ—è¡¨

#### åŸºç¡€æ—¥æœŸå¤„ç†
- âœ… `formatDate()` - æ ¼å¼åŒ–æ—¥æœŸæ˜¾ç¤º
- âœ… `handleQuickTime()` - å¿«æ·æ—¶é—´é€‰æ‹©
- âœ… `isToday()` - åˆ¤æ–­æ˜¯å¦ä¸ºä»Šå¤©
- âœ… `isYesterday()` - åˆ¤æ–­æ˜¯å¦ä¸ºæ˜¨å¤©
- âœ… `getTodayCount()` - è·å–ä»Šæ—¥æ•°æ®æ•°é‡

#### æ•°æ®åˆ†æç›¸å…³
- âœ… `getLast7DaysData()` - è·å–è¿‘7å¤©æ•°æ®ï¼ˆåŒ…æ‹¬æ¨¡æ‹Ÿæ•°æ®ï¼‰
- âœ… `formatDateForBackend()` - åç«¯æ—¥æœŸæ ¼å¼åŒ–

#### å®¡æ ¸æ“ä½œç›¸å…³
- âœ… æ»‘åŠ¨å®¡æ ¸é€šè¿‡çš„ `auditdate` å­—æ®µ
- âœ… æ»‘åŠ¨å®¡æ ¸æ‹’ç»çš„ `auditdate` å­—æ®µ  
- âœ… å•ä¸ªå®¡æ ¸é€šè¿‡çš„ `auditdate` å­—æ®µ
- âœ… å•ä¸ªå®¡æ ¸æ‹’ç»çš„ `auditdate` å­—æ®µ
- âœ… æ‰¹é‡å®¡æ ¸æ“ä½œçš„ `auditdate` å­—æ®µ

### 3. ä¿®å¤åŸç†

#### é—®é¢˜åŸå› 
iOS Safari å¯¹ `new Date()` æ„é€ å‡½æ•°çš„æ—¥æœŸå­—ç¬¦ä¸²æ ¼å¼è¦æ±‚éå¸¸ä¸¥æ ¼ï¼š
- ä¸æ”¯æŒ `"2025-07-15 17:17:51"` æ ¼å¼
- åªæ”¯æŒ ISO 8601 æ ¼å¼ï¼š`"2025-07-15T17:17:51"` æˆ– `"yyyy/MM/dd"` æ ¼å¼

#### è§£å†³æ–¹æ¡ˆ
1. **ç»Ÿä¸€å…¥å£**ï¼šæ‰€æœ‰æ—¥æœŸåˆ›å»ºéƒ½é€šè¿‡ `createSafeDate()` æ–¹æ³•
2. **å®‰å…¨è§£æ**ï¼šå­—ç¬¦ä¸²æ—¥æœŸé€šè¿‡ç°æœ‰çš„ `parseDate()` æ–¹æ³•å¤„ç†
3. **å›é€€æœºåˆ¶**ï¼šè§£æå¤±è´¥æ—¶è¿”å›å½“å‰æ—¶é—´ï¼Œé¿å…åº”ç”¨å´©æºƒ

### 4. å‰©ä½™éœ€è¦æ³¨æ„çš„åœ°æ–¹

ä»¥ä¸‹æ–¹æ³•å¯èƒ½è¿˜éœ€è¦è¿›ä¸€æ­¥æ£€æŸ¥ï¼ˆå¦‚æœå‡ºç°é—®é¢˜ï¼‰ï¼š

#### æ—¶é—´è®¡ç®—ç›¸å…³
```javascript
// è¿™äº›æ–¹æ³•ä¸­çš„ new Date() è°ƒç”¨å¯èƒ½éœ€è¦æ›¿æ¢
- getYesterdayCount()
- getTimeRangeCount()
- getWeekApprovedCount()
- getTodayEntryCount()
- getWeekCount()
- getWeekPendingCount()
- getTodayExitCount()
- getProcessedTodayCount()
```

#### æ•°æ®ç­›é€‰ç›¸å…³
```javascript
// è¿™äº›æ–¹æ³•ä¸­çš„æ—¥æœŸæ¯”è¾ƒå¯èƒ½éœ€è¦ä¼˜åŒ–
- filterByTrendDate()
- filterOvertimeItems()
- getOvertimePendingCount()
- getEfficiencyStats()
```

### 5. æµ‹è¯•éªŒè¯

#### åœ¨iOSè®¾å¤‡ä¸Šæµ‹è¯•ä»¥ä¸‹åŠŸèƒ½ï¼š
1. **é¡µé¢åŠ è½½**ï¼šç¡®ä¿é¡µé¢æ­£å¸¸åŠ è½½ï¼Œæ— æ§åˆ¶å°é”™è¯¯
2. **æ•°æ®å·¥ä½œå°**ï¼šç¡®ä¿è¶‹åŠ¿å›¾å’Œç»Ÿè®¡æ•°æ®æ­£å¸¸æ˜¾ç¤º
3. **æ—¥æœŸç­›é€‰**ï¼šæµ‹è¯•å„ç§æ—¶é—´èŒƒå›´ç­›é€‰åŠŸèƒ½
4. **å®¡æ ¸æ“ä½œ**ï¼šæµ‹è¯•é€šè¿‡/æ‹’ç»æ“ä½œï¼Œç¡®ä¿æ—¶é—´æˆ³æ­£ç¡®ä¿å­˜
5. **æ•°æ®åˆ†æ**ï¼šç‚¹å‡»è¶‹åŠ¿å›¾å’ŒçŠ¶æ€åˆ†å¸ƒå›¾ï¼Œç¡®ä¿äº¤äº’æ­£å¸¸

#### éªŒè¯æ­¥éª¤ï¼š
```bash
# 1. å¯åŠ¨é¡¹ç›®
npm run dev:mp-weixin

# 2. åœ¨iOS Safariæˆ–å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­æ‰“å¼€
# 3. æ‰“å¼€æ§åˆ¶å°ï¼Œæ£€æŸ¥æ˜¯å¦è¿˜æœ‰æ—¥æœŸç›¸å…³è­¦å‘Š
# 4. æµ‹è¯•å„é¡¹åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ
```

### 6. é¢„æœŸæ•ˆæœ

ä¿®å¤ååº”è¯¥çœ‹åˆ°ï¼š
- âœ… æ§åˆ¶å°ä¸å†æœ‰æ—¥æœŸæ ¼å¼è­¦å‘Š
- âœ… æ•°æ®å·¥ä½œå°æ­£å¸¸æ˜¾ç¤ºè¶‹åŠ¿å›¾å’Œç»Ÿè®¡æ•°æ®
- âœ… æ‰€æœ‰æ—¥æœŸç›¸å…³çš„äº¤äº’åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- âœ… å®¡æ ¸æ“ä½œçš„æ—¶é—´æˆ³æ­£ç¡®ä¿å­˜

### 7. å¦‚æœä»æœ‰é—®é¢˜

å¦‚æœåœ¨iOSè®¾å¤‡ä¸Šä»ç„¶å‡ºç°æ—¥æœŸç›¸å…³é—®é¢˜ï¼Œè¯·ï¼š

1. **æ£€æŸ¥æ§åˆ¶å°**ï¼šæŸ¥çœ‹å…·ä½“çš„é”™è¯¯ä¿¡æ¯
2. **å®šä½é—®é¢˜**ï¼šç¡®å®šæ˜¯å“ªä¸ªæ–¹æ³•è¿˜åœ¨ä½¿ç”¨ä¸å…¼å®¹çš„æ—¥æœŸæ ¼å¼
3. **åº”ç”¨ä¿®å¤**ï¼šå°† `new Date(string)` æ›¿æ¢ä¸º `this.createSafeDate(string)`
4. **æµ‹è¯•éªŒè¯**ï¼šç¡®ä¿ä¿®å¤ååŠŸèƒ½æ­£å¸¸

### 8. æœ€ä½³å®è·µ

ä»Šååœ¨æ·»åŠ æ–°çš„æ—¥æœŸå¤„ç†ä»£ç æ—¶ï¼š
- âœ… ä½¿ç”¨ `this.createCurrentDate()` æ›¿ä»£ `new Date()`
- âœ… ä½¿ç”¨ `this.createSafeDate(input)` æ›¿ä»£ `new Date(input)`
- âœ… å­—ç¬¦ä¸²æ—¥æœŸè§£æç»Ÿä¸€ä½¿ç”¨ `this.parseDate()`
- âœ… æ—¶é—´æˆ³ä½¿ç”¨æ•°å­—æ ¼å¼ï¼Œé¿å…å­—ç¬¦ä¸²æ ¼å¼

è¿™æ ·å¯ä»¥ç¡®ä¿åœ¨æ‰€æœ‰å¹³å°ä¸Šéƒ½æœ‰è‰¯å¥½çš„å…¼å®¹æ€§ï¼

## ğŸ”‡ æ—¥å¿—ä¼˜åŒ–

### å‡å°‘æ§åˆ¶å°è¾“å‡º
ä¸ºäº†é¿å…æ§åˆ¶å°è¢«å¤§é‡è°ƒè¯•ä¿¡æ¯åˆ·å±ï¼Œæˆ‘è¿˜è¿›è¡Œäº†ä»¥ä¸‹ä¼˜åŒ–ï¼š

1. **æ·»åŠ è°ƒè¯•æ¨¡å¼å¼€å…³**ï¼š
   ```javascript
   data() {
       return {
           debugMode: false, // ç”Ÿäº§ç¯å¢ƒè®¾ä¸ºfalse
           // ...
       }
   }
   ```

2. **ä¼˜åŒ–é¢‘ç¹è°ƒç”¨çš„æ–¹æ³•**ï¼š
   - âœ… `getLast7DaysData()` - æ·»åŠ ç¼“å­˜æœºåˆ¶ï¼Œå‡å°‘é‡å¤è®¡ç®—
   - âœ… `updateStatistics()` - åªåœ¨è°ƒè¯•æ¨¡å¼ä¸‹è¾“å‡ºæ—¥å¿—
   - âœ… `getTodayPendingCount()` - åªåœ¨è°ƒè¯•æ¨¡å¼ä¸‹è¾“å‡ºæ—¥å¿—
   - âœ… `getTotalCount()` - åªåœ¨è°ƒè¯•æ¨¡å¼ä¸‹è¾“å‡ºæ—¥å¿—
   - âœ… `toggleTrendExpand()` - åªåœ¨è°ƒè¯•æ¨¡å¼ä¸‹è¾“å‡ºæ—¥å¿—
   - âœ… `filterByTrendDate()` - åªåœ¨è°ƒè¯•æ¨¡å¼ä¸‹è¾“å‡ºæ—¥å¿—
   - âœ… `filterByStatus()` - åªåœ¨è°ƒè¯•æ¨¡å¼ä¸‹è¾“å‡ºæ—¥å¿—

3. **ç¼“å­˜æœºåˆ¶**ï¼š
   ```javascript
   // ç¼“å­˜7å¤©æ•°æ®ï¼Œé¿å…é¢‘ç¹è®¡ç®—
   cachedLast7DaysData() {
       const cacheKey = `${this.originalList.length}_${this.validPendingList.length}`;
       if (this._last7DaysCache && this._last7DaysCache.key === cacheKey) {
           return this._last7DaysCache.data;
       }
       const data = this.getLast7DaysDataInternal();
       this._last7DaysCache = { key: cacheKey, data };
       return data;
   }
   ```

### ç°åœ¨çš„æ§åˆ¶å°åº”è¯¥ï¼š
- âœ… ä¸å†æœ‰iOSæ—¥æœŸå…¼å®¹æ€§è­¦å‘Š
- âœ… å¤§å¹…å‡å°‘é‡å¤çš„è°ƒè¯•ä¿¡æ¯è¾“å‡º
- âœ… åªåœ¨å¿…è¦æ—¶è¾“å‡ºå…³é”®ä¿¡æ¯
- âœ… æ¨¡æ‹Ÿæ•°æ®æç¤ºåªæ˜¾ç¤ºä¸€æ¬¡

### å¦‚éœ€å¼€å¯è°ƒè¯•æ¨¡å¼ï¼š
åœ¨å¼€å‘æ—¶ï¼Œå¯ä»¥ä¸´æ—¶è®¾ç½® `debugMode: true` æ¥æŸ¥çœ‹è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ã€‚
