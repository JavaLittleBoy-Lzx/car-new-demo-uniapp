# 模板消息字段映射说明

## 您的微信模板消息信息

- **模板名称**：停车超时通知
- **模板ID**：45414
- **模板编号**：NvxG4JJ8SSfhVh1cdK0Jadz09dIN9icHlYooawCE_5k
- **所属类目**：停车服务

## 模板字段对应关系

| 模板字段 | 字段说明 | 代码中的对应值 | 颜色代码 |
|---------|---------|---------------|---------|
| `{{thing2.DATA}}` | 停车场名称 | `appointment.getYardName()` | #173177 |
| `{{car_number5.DATA}}` | 车牌号 | `appointment.getPlateNumber()` | #173177 |
| `{{const13.DATA}}` | 剩余时长 | 计算得出（如"15分钟"或"已超时"） | #FF0000 |
| `{{time9.DATA}}` | 入场时间 | `appointment.getEnterTime()` | #173177 |
| `{{time11.DATA}}` | 通知时间 | `new Date()`（当前时间） | #173177 |

## 代码实现示例

### 消息数据构建
```java
private Map<String, Object> buildMessageData(String plateNumber, String yardName, Date expectedLeaveTime, Date enterTime) {
    Map<String, Object> data = new HashMap<>();
    
    SimpleDateFormat sdf = new SimpleDateFormat("yyyy年MM月dd日 HH:mm");
    
    // 计算剩余时长
    long remainingMinutes = (expectedLeaveTime.getTime() - new Date().getTime()) / (60 * 1000);
    String remainingTime = remainingMinutes > 0 ? remainingMinutes + "分钟" : "已超时";
    
    // 根据您的微信模板消息格式构造数据
    data.put("thing2", createDataItem(yardName, "#173177"));           // 停车场名称
    data.put("car_number5", createDataItem(plateNumber, "#173177"));   // 车牌号
    data.put("const13", createDataItem(remainingTime, "#FF0000"));     // 剩余时长
    data.put("time9", createDataItem(sdf.format(enterTime), "#173177")); // 入场时间
    data.put("time11", createDataItem(sdf.format(new Date()), "#173177")); // 通知时间
    
    return data;
}
```

### 配置文件设置
```yaml
wechat:
  appid: your_wechat_appid
  secret: your_wechat_secret
  timeout:
    template:
      id: 45414  # 您的实际模板ID
```

## 实际消息效果预览

用户将收到如下格式的消息：

```
停车超时通知

停车场名称：凯达尔停车场
车牌号：粤B888888
剩余时长：15分钟
入场时间：2023年11月12日 10:30
通知时间：2023年11月12日 12:12

点击查看详情
```

## 重要说明

1. **剩余时长计算**：根据预计离场时间减去当前时间计算
2. **时间格式**：使用"yyyy年MM月dd日 HH:mm"格式
3. **颜色设置**：剩余时长使用红色(#FF0000)突出显示，其他字段使用深蓝色(#173177)
4. **超时处理**：当剩余时间为负数时显示"已超时"

## 测试建议

1. 先用测试账号验证模板消息格式是否正确
2. 确认时间格式在微信中显示正常
3. 验证剩余时长计算逻辑
4. 测试超时后的消息内容 