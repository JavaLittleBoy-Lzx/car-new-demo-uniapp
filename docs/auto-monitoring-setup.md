# 🔄 超时监控系统自动运行配置

## 概述

超时监控系统已配置为**自动运行模式**，无需手动开启。系统会在以下情况下自动启动监控：

## 🚀 自动启动时机

### 1. 应用启动时
- 在 `App.vue` 的 `onLaunch` → `initializeApp` 中自动检查并启动
- 用户认证成功后自动触发监控启动

### 2. 应用回到前台时
- 在 `App.vue` 的 `onShow` 中自动检查监控状态
- 确保后台运行期间监控保持活跃

### 3. 停车状态变化时
- 监听 `parking-status-changed` 事件
- 自动重新评估监控需求

## 🔧 自动运行机制

### 权限检查
- 自动检查用户角色（manager、owner）
- 无权限用户自动跳过监控启动

### 智能启动条件
- 自动查询2小时内活跃车辆数量
- 只有存在活跃车辆时才启动监控
- 避免无意义的资源消耗

### 健康检查
- 每5分钟自动检查监控状态
- 发现监控停止时自动重新启动
- 确保监控服务持续可用

## 📊 监控状态

### 状态属性
```javascript
{
  isMonitoring: boolean,      // 是否正在监控
  autoMode: true,             // 自动运行模式（恒为true）
  recentActiveCount: number,  // 活跃车辆数量
  checkInterval: 60000,       // 检查间隔（1分钟）
  lastCheckTime: Date,        // 上次检查时间
  retryCount: number          // 重试次数
}
```

## 🎯 事件系统

### 自动触发的事件
- `monitoring-status-changed`: 监控状态变化
- `parking-status-changed`: 停车状态变化
- `user-logout`: 用户登出时自动停止监控

## 🔍 调试功能

### 调试页面位置
- 路径: `/pages/debug/timeout-monitor`
- 显示自动运行状态
- 提供手动控制选项（仅用于调试）

### 全局调试方法
```javascript
// 在控制台中可用的调试方法
getApp().debugTimeoutMonitoring()     // 查看监控状态
getApp().restartTimeoutMonitoring()   // 手动重启监控
getApp().forceCheckTimeout()          // 强制检查超时
```

## ✅ 配置验证

1. **应用启动日志确认**:
   ```
   🔄 [App] 正在自动启动超时监控系统...
   🟢 [App] 超时监控已自动启动成功
   🏥 [App] 自动监控健康检查已设置，间隔5分钟
   ```

2. **监控服务日志确认**:
   ```
   🔄 [TimeoutMonitoring] 监控工具类初始化完成 - 自动运行模式
   🚀 [App] 监控自动启动结果: true
   ```

3. **调试页面确认**:
   - 运行模式显示为"自动运行"
   - 监控状态显示为"运行中"（如有活跃车辆）

## 📝 注意事项

1. **无需手动操作**: 监控系统完全自动化，普通用户无需进行任何手动操作
2. **权限控制**: 只有 manager 和 owner 角色的用户会自动启动监控
3. **资源优化**: 无活跃车辆时自动停止监控，节省系统资源
4. **容错机制**: 网络异常或API错误时会自动重试，确保服务稳定

## 🛠️ 故障排除

如果监控未自动启动，请检查：
1. 用户是否已正确登录且角色为 manager 或 owner
2. 是否存在2小时内的活跃停车记录
3. 网络连接是否正常
4. 查看控制台日志了解具体错误信息

---

配置完成后，超时监控系统将在满足条件时自动运行，无需任何手动干预。 