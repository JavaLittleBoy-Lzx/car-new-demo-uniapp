# 花生壳配置验证指南

## 🎯 配置概览

您的配置信息：
- **花生壳域名**: https://csharphrb.picp.vip
- **本地后端**: http://localhost:8543
- **映射状态**: ✅ 已映射

## 📋 验证步骤

### 1. 验证花生壳映射是否正常

#### 1.1 测试基本连通性
在浏览器中访问：
```
https://csharphrb.picp.vip/parking/wechat/checkPermission
```

如果能看到响应（即使是错误信息），说明映射成功。

#### 1.2 测试API端点
```bash
# 使用 curl 测试（如果有的话）
curl https://csharphrb.picp.vip/parking/butler/getByPhone?phone=13800138000

# 或者在浏览器中直接访问
https://csharphrb.picp.vip/parking/butler/getByPhone?phone=13800138000
```

### 2. 微信开发者后台配置验证

#### 2.1 检查配置是否保存成功
1. 登录 https://mp.weixin.qq.com
2. 进入【设置】→【开发设置】
3. 确认【服务器域名】中包含：
   ```
   request合法域名: https://csharphrb.picp.vip
   ```

#### 2.2 验证域名校验文件（如果需要）
微信可能要求上传域名校验文件，如果需要：
1. 下载校验文件（MP_verify_xxx.txt）
2. 放置到后端静态资源目录
3. 确保能通过 https://csharphrb.picp.vip/MP_verify_xxx.txt 访问

### 3. 小程序开发工具验证

#### 3.1 检查网络请求
1. 打开微信开发者工具
2. 在调试器的【Network】标签中查看请求
3. 确认API请求指向 https://csharphrb.picp.vip

#### 3.2 测试API调用
在小程序中测试以下功能：
- 管家信息获取
- 二维码生成
- 访客申请提交

### 4. 功能测试

#### 4.1 生成小程序码
1. 登录管家账号
2. 进入二维码生成页面
3. 选择"小程序码"类型
4. 生成二维码，查看是否成功

#### 4.2 扫码测试
1. 使用微信扫描生成的小程序码
2. 确认能够跳转到访客申请页面
3. 检查信息是否自动填入

## ⚠️ 常见问题

### 问题1：域名配置后仍然报错
**解决方案**：
- 确认花生壳服务正常运行
- 检查本地后端服务是否启动（端口8543）
- 等待微信配置生效（可能需要几分钟）

### 问题2：HTTPS证书问题
**解决方案**：
- 花生壳提供的域名应该自带SSL证书
- 如果提示证书问题，检查花生壳配置
- 确保使用的是 https 而不是 http

### 问题3：API调用超时
**解决方案**：
- 内网穿透可能较慢，增加超时时间
- 检查网络连接稳定性
- 确认花生壳账号流量充足

### 问题4：微信小程序码API调用失败
**解决方案**：
- 确认已获取小程序的 AppID 和 AppSecret
- 检查 access_token 获取是否正常
- 验证微信API调用限制

## 🔧 调试技巧

### 1. 查看网络请求日志
```javascript
// 在小程序中添加请求日志
console.log('API请求地址:', 'https://csharphrb.picp.vip/parking/xxx');
console.log('请求参数:', requestData);
```

### 2. 后端日志监控
```bash
# 监控后端日志，查看是否收到请求
tail -f your-backend.log
```

### 3. 花生壳状态检查
- 打开花生壳客户端
- 确认映射状态为"连接成功"
- 检查流量使用情况

## 🎯 成功标志

当以下条件都满足时，配置即为成功：

✅ 花生壳域名可以正常访问后端API  
✅ 微信开发者后台域名配置无错误提示  
✅ 小程序中API请求正常返回数据  
✅ 小程序码生成功能正常工作  
✅ 扫码跳转功能正常  

## 📞 技术支持

如果遇到问题，可以检查：
1. 花生壳官方文档：https://service.oray.com/
2. 微信小程序开发文档
3. 本项目的配置文档

配置成功后，您的小程序就可以使用真正的扫码跳转功能了！ 