# 开发模式配置说明

## 🔧 手机号统一配置

为了确保开发测试的一致性，前后端已统一使用相同的测试手机号：

### 当前配置
- **测试手机号**: `13593527970`
- **原因**: 这是数据库中真实存在的业主手机号，可以测试完整的业主身份验证流程

### 配置位置

#### 前端配置 (car-new-demo/pages/auth/phone-auth.vue)
```javascript
// mockAuthData() 方法中
const mockPhone = '13593527970'; // 与后端保持一致
```

#### 后端配置 (parking-demo/src/main/java/com/parkingmanage/utils/WeChatUtils.java)
```java
// 开发模式下的测试配置
private static final String TEST_PHONE_NUMBER = "13593527970";
```

## 🧪 测试流程

### 开发模式测试（推荐）
1. **启动后端服务**：端口 8543
2. **运行小程序**：进入授权页面
3. **点击授权按钮**：系统会自动调用后端接口
4. **后端处理**：
   - 接收微信授权参数
   - 开发模式下直接返回测试手机号 `13593527970`
   - 执行四层角色判断逻辑
   - 应该识别为业主角色

### 网络异常测试模式
如果后端服务不可用，系统会：
1. **显示网络错误**
2. **提供测试模式选项**
3. **使用相同的测试手机号** `13593527970`
4. **前端模拟角色选择**

## 📊 预期测试结果

使用手机号 `13593527970` 进行测试时，应该看到：

```
🔍 开始四层角色查询，手机号: [13593527970], openid: [mock_openid_...]
❌ 第一层查询：未找到管家，继续下一层查询
✅ 第二层查询成功：找到业主角色（本地数据）
```

最终结果：
- **角色**: `owner` (业主)
- **权限**: 预约创建、个人预约查询、个人违规查看
- **TabBar**: 显示3个Tab（预约、预约查询、违规车辆）

## 🔄 修改测试手机号

如需测试其他角色，可以修改测试手机号：

### 测试管家角色
```java
// 如果数据库中有管家手机号，可以改为：
private static final String TEST_PHONE_NUMBER = "管家的真实手机号";
```

### 测试访客角色
```java
// 使用一个不在业主和管家表中的手机号：
private static final String TEST_PHONE_NUMBER = "13800138000";
```

### 测试未注册用户
```java
// 使用一个完全不存在的手机号：
private static final String TEST_PHONE_NUMBER = "15999999999";
```

## 🚀 生产环境配置

生产环境部署时，需要：

1. **关闭开发模式**:
```java
private static final boolean IS_DEV_MODE = false;
```

2. **配置真实微信参数**:
```java
private static final String APP_ID = "你的真实AppID";
private static final String APP_SECRET = "你的真实AppSecret";
```

3. **删除测试代码**:
   - 移除前端的 `mockAuthData()` 方法
   - 移除所有测试相关的日志输出

## 📝 注意事项

1. **数据一致性**: 确保测试手机号在数据库中有对应的数据
2. **权限测试**: 不同角色需要使用对应的真实手机号进行测试
3. **日志输出**: 开发模式下会有详细的日志输出，生产环境需要调整日志级别
4. **缓存清理**: 测试时注意清理本地存储和应用缓存

## 🐛 常见问题

### Q: 为什么后端获取的手机号和预期不一样？
A: 确保前后端使用相同的测试手机号配置。

### Q: 如何测试四层角色判断？
A: 依次使用管家手机号、业主手机号、访客手机号、未注册手机号进行测试。

### Q: 网络连接失败怎么办？
A: 系统会自动提供测试模式选项，使用前端模拟数据继续测试。 