# è½¦ç‰Œè¯†åˆ«216201é”™è¯¯æœ€ç»ˆä¿®å¤æ–¹æ¡ˆ

## é”™è¯¯åˆ†æ

æ ¹æ®ç”¨æˆ·æä¾›çš„ç™¾åº¦å®˜æ–¹Javaç¤ºä¾‹ä»£ç ï¼Œæˆ‘ä»¬å‘ç°äº†å…³é”®é—®é¢˜ï¼š

### é—®é¢˜æ ¹æº
æˆ‘ä»¬ä¹‹å‰é”™è¯¯åœ°è®¤ä¸ºä¸éœ€è¦å¯¹base64å›¾ç‰‡æ•°æ®è¿›è¡ŒURLç¼–ç ï¼Œä½†ç™¾åº¦å®˜æ–¹ç¤ºä¾‹æ˜ç¡®æ˜¾ç¤ºéœ€è¦URLç¼–ç ï¼š

```java
// ç™¾åº¦å®˜æ–¹ç¤ºä¾‹
String imgParam = URLEncoder.encode(imgStr, "UTF-8");
String param = "image=" + imgParam;
```

## æœ€ç»ˆä¿®å¤æ–¹æ¡ˆ

### 1. æ¢å¤URLç¼–ç  âœ…

**ä¿®æ”¹æ–‡ä»¶**: `PlateRecognitionServiceImpl.java`

```java
// ä¿®æ­£åçš„ä»£ç 
String encodedImage = java.net.URLEncoder.encode(base64Image, "UTF-8");
paramBuilder.append("image=").append(encodedImage);
```

### 2. æ·»åŠ å›¾ç‰‡æ ¼å¼è°ƒè¯•åŠŸèƒ½ âœ…

**æ–°å¢è°ƒè¯•æ¥å£**: `/api/plate/debug/image-format`

**åŠŸèƒ½**:
- åˆ†æbase64æ•°æ®æ ¼å¼
- æ£€æµ‹å›¾ç‰‡æ–‡ä»¶å¤´
- éªŒè¯å›¾ç‰‡æ ¼å¼(JPEG/PNG/BMP)
- è¿”å›è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯

### 3. å‰ç«¯è‡ªåŠ¨è°ƒè¯• âœ…

æ¯æ¬¡è¯†åˆ«å‰è‡ªåŠ¨è°ƒç”¨è°ƒè¯•æ¥å£ï¼Œåœ¨æ§åˆ¶å°è¾“å‡ºå›¾ç‰‡åˆ†æç»“æœï¼š

```
ğŸ“Š å›¾ç‰‡æ ¼å¼è°ƒè¯•ä¿¡æ¯:
æ ¼å¼: JPEG
åŸå§‹é•¿åº¦: 245032
æ¸…ç†åé•¿åº¦: 245020  
è§£ç å¤§å°: 183774å­—èŠ‚
æ–‡ä»¶å¤´: FFD8FFE0
æ˜¯å¦æœ‰æ•ˆ: âœ…
```

## æµ‹è¯•æ­¥éª¤

### 1. é‡å¯åç«¯æœåŠ¡
```bash
cd parking-demo
mvn spring-boot:run
```

### 2. æµ‹è¯•è½¦ç‰Œè¯†åˆ«
1. æ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·
2. è¿›å…¥`pages/demo/plate-scanner`é¡µé¢
3. é€‰æ‹©åŒ…å«è½¦ç‰Œçš„å›¾ç‰‡
4. æŸ¥çœ‹æ§åˆ¶å°è°ƒè¯•ä¿¡æ¯

### 3. åˆ†æè°ƒè¯•ç»“æœ

**æ­£å¸¸æƒ…å†µ**:
```
ğŸ” å›¾ç‰‡åˆ†æç»“æœ:
æ ¼å¼: JPEG âœ…
åŸå§‹é•¿åº¦: 245032
æ¸…ç†åé•¿åº¦: 245020
è§£ç å¤§å°: 183774å­—èŠ‚
æ–‡ä»¶å¤´: FFD8FFE0
æ˜¯å¦æœ‰æ•ˆ: âœ…
```

**å¼‚å¸¸æƒ…å†µæ’æŸ¥**:
- æ ¼å¼éJPEG/PNG/BMP â†’ è½¬æ¢å›¾ç‰‡æ ¼å¼
- è§£ç å¤§å°è¿‡å¤§(>8MB) â†’ å‹ç¼©å›¾ç‰‡
- æ˜¯å¦æœ‰æ•ˆ: âŒ â†’ æ£€æŸ¥base64æ•°æ®

## æ”¯æŒçš„å›¾ç‰‡æ ¼å¼

| æ ¼å¼ | æ–‡ä»¶å¤´ | è¯´æ˜ |
|------|--------|------|
| JPEG | FFD8 | æ¨èæ ¼å¼ï¼Œå…¼å®¹æ€§æœ€å¥½ |
| PNG | 8950 | æ”¯æŒé€æ˜èƒŒæ™¯ |
| BMP | 424D | Windowsä½å›¾æ ¼å¼ |

## å¸¸è§é”™è¯¯ç è§£å†³æ–¹æ¡ˆ

| é”™è¯¯ç  | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|--------|------|----------|
| 216201 | å›¾ç‰‡æ ¼å¼é”™è¯¯ | ä½¿ç”¨JPEG/PNG/BMPæ ¼å¼ |
| 216200 | æœªæ£€æµ‹åˆ°è½¦ç‰Œ | ç¡®ä¿å›¾ç‰‡åŒ…å«æ¸…æ™°è½¦ç‰Œ |
| 216103 | å›¾ç‰‡è¿‡å¤§ | å‹ç¼©å›¾ç‰‡åˆ°8MBä»¥ä¸‹ |
| 110 | è®¿é—®ä»¤ç‰Œæ— æ•ˆ | æ£€æŸ¥APIå¯†é’¥é…ç½® |

## APIè°ƒç”¨æµç¨‹

```mermaid
graph TD
    A[ä¸Šä¼ å›¾ç‰‡] --> B[è½¬æ¢Base64]
    B --> C[æ¸…ç†æ•°æ®å¤´]
    C --> D[è°ƒè¯•æ ¼å¼æ£€æŸ¥]
    D --> E{æ ¼å¼æ˜¯å¦æœ‰æ•ˆ?}
    E -->|å¦| F[æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯]
    E -->|æ˜¯| G[URLç¼–ç ]
    G --> H[è°ƒç”¨ç™¾åº¦API]
    H --> I[è§£æç»“æœ]
```

## å…³é”®ä»£ç å˜æ›´

### 1. URLç¼–ç ä¿®å¤

```java
// ä¿®æ­£å‰ (é”™è¯¯)
paramBuilder.append("image=").append(base64Image);

// ä¿®æ­£å (æ­£ç¡®)
String encodedImage = java.net.URLEncoder.encode(base64Image, "UTF-8");
paramBuilder.append("image=").append(encodedImage);
```

### 2. è°ƒè¯•åŠŸèƒ½

```java
@ApiOperation("è°ƒè¯•å›¾ç‰‡æ ¼å¼")
@PostMapping("/debug/image-format")
public ResponseEntity<Result<Map<String, Object>>> debugImageFormat(@RequestBody PlateRecognitionRequest request) {
    // åˆ†æå›¾ç‰‡æ ¼å¼ã€å¤§å°ã€æœ‰æ•ˆæ€§
    // è¿”å›è¯¦ç»†è°ƒè¯•ä¿¡æ¯
}
```

## é¢„æœŸæ•ˆæœ

ä¿®å¤ååº”è¯¥ä¸å†å‡ºç°216201é”™è¯¯ï¼Œå¹¶ä¸”ï¼š

1. âœ… å›¾ç‰‡æ ¼å¼è‡ªåŠ¨æ£€æµ‹
2. âœ… è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯
3. âœ… æ­£ç¡®çš„URLç¼–ç 
4. âœ… ç¬¦åˆç™¾åº¦å®˜æ–¹è§„èŒƒ

## å¦‚æœä»æœ‰é—®é¢˜

è¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
1. æ§åˆ¶å°è°ƒè¯•è¾“å‡º
2. åç«¯æœåŠ¡æ—¥å¿—
3. æµ‹è¯•å›¾ç‰‡çš„æ ¼å¼å’Œå¤§å°
4. å…·ä½“é”™è¯¯ä¿¡æ¯

---

**æ›´æ–°æ—¶é—´**: 2025-06-28  
**çŠ¶æ€**: ï¿½ï¿½ æœ€ç»ˆä¿®å¤æ–¹æ¡ˆï¼Œåº”è§£å†³216201é”™è¯¯ 