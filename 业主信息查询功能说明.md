# 二维码生成页面 - 业主信息查询功能实现说明

## 功能概述

在 `pagesB/butler/qrcode-generator.vue` 页面中实现了管家选择地址时动态查询业主信息的功能，用户选择业主后会自动填充地址信息。

## 主要功能特性

### 1. 动态业主查询
- 当管家选择社区、楼栋、单元、楼层时，系统会自动查询该地址下的所有业主信息
- 支持精确到房间号的业主查询
- 实时显示查询到的业主数量

### 2. 业主搜索功能
- 提供搜索框，支持按业主姓名或手机号搜索
- 实时搜索，输入即时过滤结果
- 支持清除搜索条件

### 3. 业主信息展示
- 显示业主姓名、手机号
- 显示业主详细地址（楼栋、单元、楼层、房间号）
- 显示业主审核状态（已审核、待审核、已拒绝）
- 支持选择业主，选中状态有视觉反馈

### 4. 自动地址填充
- 选择业主后，自动填充完整的地址信息
- 包括省、市、区、社区、楼栋、单元、楼层、房间号
- 实时更新地址预览

### 5. 用户体验优化
- 加载状态提示
- 无数据时的友好提示
- 选中业主的预览展示
- 响应式设计，适配不同屏幕

## 技术实现

### 1. 数据结构
```javascript
// 业主相关数据
ownerList: [], // 当前地址的业主列表
filteredOwnerList: [], // 过滤后的业主列表
selectedOwner: null, // 选中的业主
ownerSearchKeyword: '', // 业主搜索关键词
ownerLoading: false, // 业主查询加载状态
ownerSearched: false, // 是否已经搜索过业主
```

### 2. 核心方法

#### `searchOwnersForCurrentAddress()`
- 根据当前选择的地址查询业主信息
- 调用 `/parking/ownerinfo/myRooms` API
- 支持按地址层级查询（社区、楼栋、单元、楼层、房间）

#### `selectOwner(owner)`
- 选择业主并自动填充地址信息
- 调用 `autoFillAddressFromOwner()` 方法

#### `autoFillAddressFromOwner(owner)`
- 根据业主信息自动填充地址选择器
- 更新 `selectedAddress` 对象的所有字段

#### `filterOwnerList()`
- 根据搜索关键词过滤业主列表
- 支持按姓名和手机号搜索

### 3. UI组件

#### 业主选择器
- 位置：地址选择器下方
- 显示条件：已选择社区时显示
- 包含搜索框、业主列表、加载状态、无数据提示

#### 选中业主预览
- 显示已选择的业主信息
- 包含姓名、电话、详细地址
- 特殊样式突出显示

### 4. 样式设计
- 卡片式设计，圆角阴影
- 选中状态有蓝色边框和背景
- 状态标签有不同颜色（绿色已审核、橙色待审核、红色已拒绝）
- 响应式布局，适配移动端

## API接口

### 查询业主信息
- **接口**: `GET /parking/ownerinfo/myRooms`
- **参数**: 
  - `province`: 省份
  - `city`: 城市
  - `district`: 区县
  - `community`: 社区
  - `building`: 楼栋
  - `units`: 单元
  - `floor`: 楼层
  - `roomnumber`: 房间号
  - `userphone`: 手机号（为空时查询所有业主）

### 返回数据格式
```javascript
{
  "code": "0",
  "data": [
    {
      "id": 1,
      "province": "黑龙江省",
      "city": "哈尔滨市",
      "district": "南岗区",
      "community": "四季上东",
      "building": "1",
      "units": 1,
      "floor": 1,
      "roomnumber": 101,
      "ownername": "张三",
      "ownerphone": "13800138000",
      "isaudit": "1",
      "permitverify": "1",
      "plates": "黑A12345",
      "parkingspaces": "A001"
    }
  ]
}
```

## 使用流程

1. 管家进入二维码生成页面
2. 选择省、市、区、社区（必选）
3. 系统自动查询该社区的所有业主
4. 可选择楼栋、单元、楼层、房间进一步筛选业主
5. 在业主列表中搜索或直接选择目标业主
6. 选择业主后，地址信息自动填充
7. 生成访客二维码

## 注意事项

1. 业主查询依赖于地址信息，至少需要选择到社区级别
2. 地址变更时会清除之前的业主选择
3. 业主信息来源于 `ownerinfo` 数据表
4. 支持无业主数据的情况，会显示友好提示
5. 所有操作都有加载状态和错误处理

## 扩展功能建议

1. 支持业主信息的实时更新
2. 添加业主头像显示
3. 支持批量选择业主
4. 添加业主联系功能
5. 支持业主信息的缓存机制
