# ç®¡å®¶æŸ¥è¯¢é¡µé¢è·³è½¬ä¿®å¤è¯´æ˜

## é—®é¢˜æè¿°

ç®¡å®¶ç‚¹å‡» TabBar çš„"é¢„çº¦æŸ¥è¯¢"å›¾æ ‡æ—¶ï¼Œé»˜è®¤è¿›å…¥çš„æ˜¯é¢„çº¦åˆ—è¡¨é¡µé¢ï¼ˆå›¾1ï¼‰ï¼Œè€Œä¸æ˜¯è®¿å®¢é‚€è¯·é¡µé¢ï¼ˆå›¾2ï¼‰ã€‚

**æœŸæœ›è¡Œä¸º**ï¼š
- ç®¡å®¶è§’è‰² â†’ è·³è½¬åˆ°è®¿å®¢é‚€è¯·é¡µé¢ `pagesB/butler/qrcode-generator`
- å…¶ä»–è§’è‰² â†’ è·³è½¬åˆ°é¢„çº¦æŸ¥è¯¢é¡µé¢ `pagesA/reservation/searchResult/searchResult`

---

## ä¿®å¤æ–¹æ¡ˆ

åœ¨ä¸¤ä¸ªåœ°æ–¹æ·»åŠ è§’è‰²åˆ¤æ–­é€»è¾‘ï¼š

1. **searchResult.vue** - é¡µé¢åŠ è½½æ—¶æ£€æµ‹ç®¡å®¶è§’è‰²å¹¶è·³è½¬
2. **custom-tabbar.vue** - TabBarç‚¹å‡»æ—¶æ ¹æ®è§’è‰²è·³è½¬åˆ°ä¸åŒé¡µé¢

---

## ä¿®å¤å†…å®¹

### 1. searchResult.vue - é¡µé¢åŠ è½½è·³è½¬

**æ–‡ä»¶**ï¼š`pagesA/reservation/searchResult/searchResult.vue`

#### ä¿®æ”¹ onLoad() æ–¹æ³•

**ä½ç½®**ï¼šç¬¬807-825è¡Œ

```javascript
onLoad(options) {
    // è®¾ç½®çŠ¶æ€æ é«˜åº¦
    this.setStatusBarHeight();

    // æ¸…é™¤å¯èƒ½å­˜åœ¨çš„æ‰‹åŠ¨é€‰æ‹©çš„å°åŒºå­˜å‚¨
    uni.removeStorageSync('managerSelectedCommunity');
    console.log('ğŸ§¹ [æ¸…ç†] å·²æ¸…é™¤æ‰‹åŠ¨é€‰æ‹©çš„å°åŒºå­˜å‚¨');

    // è·å–ç”¨æˆ·è§’è‰²
    this.getUserRole();

    // âœ… å¦‚æœæ˜¯ç®¡å®¶è§’è‰²ï¼Œç›´æ¥è·³è½¬åˆ°è®¿å®¢é‚€è¯·é¡µé¢
    if (this.currentUserRole === 'manager') {
        console.log('ğŸ‘¨â€ğŸ’¼ [ç®¡å®¶è·³è½¬] æ£€æµ‹åˆ°ç®¡å®¶è§’è‰²ï¼Œè·³è½¬åˆ°è®¿å®¢é‚€è¯·é¡µé¢');
        uni.redirectTo({
            url: '/pagesB/butler/qrcode-generator'
        });
        return; // ç»ˆæ­¢åç»­æ‰§è¡Œ
    }

    // åç»­ä»£ç ...
}
```

#### ä¿®æ”¹ onShow() æ–¹æ³•

**ä½ç½®**ï¼šç¬¬868-876è¡Œ

```javascript
onShow() {
    // âœ… å¦‚æœæ˜¯ç®¡å®¶è§’è‰²ï¼Œç›´æ¥è·³è½¬åˆ°è®¿å®¢é‚€è¯·é¡µé¢
    if (this.currentUserRole === 'manager') {
        console.log('ğŸ‘¨â€ğŸ’¼ [ç®¡å®¶è·³è½¬-onShow] æ£€æµ‹åˆ°ç®¡å®¶è§’è‰²ï¼Œè·³è½¬åˆ°è®¿å®¢é‚€è¯·é¡µé¢');
        uni.redirectTo({
            url: '/pagesB/butler/qrcode-generator'
        });
        return; // ç»ˆæ­¢åç»­æ‰§è¡Œ
    }

    // å¼ºåˆ¶éšè—ç³»ç»ŸTabBar
    this.hideSystemTabBar();
    
    // åç»­ä»£ç ...
}
```

**ä½œç”¨**ï¼š
- `onLoad` - é¡µé¢é¦–æ¬¡åŠ è½½æ—¶è·³è½¬
- `onShow` - é€šè¿‡ TabBar åˆ‡æ¢å›æ¥æ—¶ä¹Ÿä¼šè·³è½¬

---

### 2. custom-tabbar.vue - TabBarè·³è½¬é€»è¾‘

**æ–‡ä»¶**ï¼š`components/custom-tabbar.vue`

#### ä¿®æ”¹ navigateToQueryPage() æ–¹æ³•

**ä½ç½®**ï¼šç¬¬634-680è¡Œ

**ä¿®æ”¹å‰**ï¼š
```javascript
navigateToQueryPage() {
    console.log('ğŸ” [TabBar] å¯¼èˆªåˆ°æŸ¥è¯¢é¡µé¢');

    // ç»Ÿä¸€è·³è½¬åˆ°é¢„çº¦æŸ¥è¯¢é¡µé¢
    // ä¸ç®¡æ˜¯ä»€ä¹ˆè§’è‰²ï¼Œéƒ½ä½¿ç”¨è¿™ä¸ªæ ‡å‡†çš„æŸ¥è¯¢é¡µé¢  â† âŒ é—®é¢˜æ‰€åœ¨
    uni.reLaunch({
        url: '/pagesA/reservation/searchResult/searchResult',
        success: () => {
            console.log('âœ… [TabBar] æˆåŠŸè·³è½¬åˆ°é¢„çº¦æŸ¥è¯¢é¡µé¢');
            // ...
        },
        fail: (err) => {
            // ...
        }
    });
}
```

**ä¿®æ”¹å**ï¼š
```javascript
navigateToQueryPage() {
    console.log('ğŸ” [TabBar] å¯¼èˆªåˆ°æŸ¥è¯¢é¡µé¢');

    // âœ… æ ¹æ®è§’è‰²è·³è½¬åˆ°ä¸åŒé¡µé¢
    // ç®¡å®¶ -> è®¿å®¢é‚€è¯·é¡µé¢
    // å…¶ä»–è§’è‰² -> é¢„çº¦æŸ¥è¯¢é¡µé¢
    const targetUrl = this.currentUserRole === 'manager' 
        ? '/pagesB/butler/qrcode-generator'
        : '/pagesA/reservation/searchResult/searchResult';

    console.log(`ğŸ‘¤ [TabBar] å½“å‰è§’è‰²: ${this.currentUserRole}, è·³è½¬åˆ°: ${targetUrl}`);

    uni.reLaunch({
        url: targetUrl,
        success: () => {
            console.log(`âœ… [TabBar] æˆåŠŸè·³è½¬åˆ°${this.currentUserRole === 'manager' ? 'è®¿å®¢é‚€è¯·' : 'é¢„çº¦æŸ¥è¯¢'}é¡µé¢`);
            // æ›´æ–°TabBarçŠ¶æ€åˆ°æŸ¥è¯¢é¡µé¢
            const queryTabIndex = this.visibleTabs.findIndex(tab =>
                tab.pagePath === 'pages/reservation/searchResult/searchResult' ||
                tab.pagePath === 'pagesB/butler/qrcode-generator'
            );
            if (queryTabIndex !== -1) {
                this.currentIndex = queryTabIndex;
                uni.$emit('updateTabBarIndex', queryTabIndex);
            }
        },
        fail: (err) => {
            console.error('âŒ [TabBar] reLaunchå¤±è´¥:', err);
            // å¦‚æœreLaunchå¤±è´¥ï¼Œå°è¯•ä½¿ç”¨navigateTo
            uni.navigateTo({
                url: targetUrl,
                success: () => {
                    console.log('âœ… [TabBar] ä½¿ç”¨navigateToæˆåŠŸè·³è½¬');
                },
                fail: (navErr) => {
                    console.error('âŒ [TabBar] navigateToä¹Ÿå¤±è´¥:', navErr);
                    uni.showToast({
                        title: 'è·³è½¬å¤±è´¥ï¼Œè¯·é‡è¯•',
                        icon: 'none',
                        duration: 2000
                    });
                }
            });
        }
    });
}
```

**å…³é”®æ”¹åŠ¨**ï¼š
1. âœ… æ ¹æ® `currentUserRole` åŠ¨æ€è®¾ç½®ç›®æ ‡ URL
2. âœ… ç®¡å®¶è·³è½¬åˆ° `/pagesB/butler/qrcode-generator`
3. âœ… å…¶ä»–è§’è‰²è·³è½¬åˆ° `/pagesA/reservation/searchResult/searchResult`
4. âœ… æ›´æ–° TabBar ç´¢å¼•æŸ¥æ‰¾é€»è¾‘ï¼Œæ”¯æŒä¸¤ä¸ªé¡µé¢è·¯å¾„

---

## è·³è½¬æµç¨‹å¯¹æ¯”

### ä¿®å¤å‰ âŒ

```
ç®¡å®¶ç‚¹å‡»"é¢„çº¦æŸ¥è¯¢"
    â†“
è·³è½¬åˆ° searchResult.vue
    â†“
æ˜¾ç¤ºé¢„çº¦åˆ—è¡¨ï¼ˆå›¾1ï¼‰
    â†“
âŒ ä¸ç¬¦åˆç®¡å®¶ä½¿ç”¨ä¹ æƒ¯
```

### ä¿®å¤å âœ…

```
ç®¡å®¶ç‚¹å‡»"é¢„çº¦æŸ¥è¯¢"
    â†“
TabBar: currentUserRole === 'manager'
    â†“
è·³è½¬åˆ° /pagesB/butler/qrcode-generator
    â†“
æ˜¾ç¤ºè®¿å®¢é‚€è¯·é¡µé¢ï¼ˆå›¾2ï¼‰
    â†“
âœ… ç¬¦åˆç®¡å®¶å·¥ä½œæµç¨‹
```

### è®¿å®¢/ä¸šä¸»æµç¨‹ï¼ˆä¸å˜ï¼‰

```
è®¿å®¢/ä¸šä¸»ç‚¹å‡»"é¢„çº¦æŸ¥è¯¢"
    â†“
TabBar: currentUserRole !== 'manager'
    â†“
è·³è½¬åˆ° /pagesA/reservation/searchResult/searchResult
    â†“
æ˜¾ç¤ºé¢„çº¦åˆ—è¡¨
    â†“
âœ… æ­£å¸¸æŸ¥è¯¢é¢„çº¦
```

---

## é˜²å¾¡æ€§è®¾è®¡

### åŒé‡ä¿æŠ¤

å³ä½¿ TabBar è·³è½¬é€»è¾‘æ²¡æœ‰æ­£ç¡®æ‰§è¡Œï¼Œ`searchResult.vue` ä¸­çš„ `onLoad` å’Œ `onShow` ä¹Ÿä¼šå†æ¬¡æ£€æŸ¥å¹¶è·³è½¬ï¼š

```javascript
// searchResult.vue
onLoad() {
    if (this.currentUserRole === 'manager') {
        uni.redirectTo({
            url: '/pagesB/butler/qrcode-generator'
        });
        return;
    }
    // ç»§ç»­åŠ è½½é¡µé¢
}

onShow() {
    if (this.currentUserRole === 'manager') {
        uni.redirectTo({
            url: '/pagesB/butler/qrcode-generator'
        });
        return;
    }
    // åˆ·æ–°æ•°æ®
}
```

**å¥½å¤„**ï¼š
- ç¡®ä¿ç®¡å®¶æ— è®ºå¦‚ä½•éƒ½ä¼šè·³è½¬åˆ°æ­£ç¡®é¡µé¢
- å³ä½¿ç›´æ¥è¾“å…¥ URL è®¿é—® searchResult ä¹Ÿä¼šè¢«æ‹¦æˆª

---

## è§’è‰²åˆ¤æ–­é€»è¾‘

```javascript
// è·å–ç”¨æˆ·è§’è‰²
getUserRole() {
    try {
        const userInfo = uni.getStorageSync('userInfo');

        if (userInfo && userInfo.role) {
            this.currentUserRole = userInfo.role;
        } else if (userInfo && userInfo.userInfo && userInfo.userInfo.userkind) {
            this.currentUserRole = userInfo.userInfo.userkind;
        } else {
            this.currentUserRole = 'manager'; // é»˜è®¤ç®¡å®¶
        }
    } catch (error) {
        this.currentUserRole = 'manager';
    }
}
```

**è§’è‰²å€¼**ï¼š
- `'manager'` - ç®¡å®¶
- `'owner'` - ä¸šä¸»
- `'visitor'` - è®¿å®¢

---

## æ§åˆ¶å°æ—¥å¿—

### ç®¡å®¶è·³è½¬æ—¥å¿—

```
ğŸ” [TabBar] å¯¼èˆªåˆ°æŸ¥è¯¢é¡µé¢
ğŸ‘¤ [TabBar] å½“å‰è§’è‰²: manager, è·³è½¬åˆ°: /pagesB/butler/qrcode-generator
âœ… [TabBar] æˆåŠŸè·³è½¬åˆ°è®¿å®¢é‚€è¯·é¡µé¢
```

æˆ–è€…ï¼ˆå¦‚æœè¿›å…¥äº† searchResultï¼‰ï¼š

```
ğŸ‘¨â€ğŸ’¼ [ç®¡å®¶è·³è½¬] æ£€æµ‹åˆ°ç®¡å®¶è§’è‰²ï¼Œè·³è½¬åˆ°è®¿å®¢é‚€è¯·é¡µé¢
```

### å…¶ä»–è§’è‰²è·³è½¬æ—¥å¿—

```
ğŸ” [TabBar] å¯¼èˆªåˆ°æŸ¥è¯¢é¡µé¢
ğŸ‘¤ [TabBar] å½“å‰è§’è‰²: visitor, è·³è½¬åˆ°: /pagesA/reservation/searchResult/searchResult
âœ… [TabBar] æˆåŠŸè·³è½¬åˆ°é¢„çº¦æŸ¥è¯¢é¡µé¢
```

---

## é¡µé¢åŠŸèƒ½å¯¹æ¯”

### å›¾1 - é¢„çº¦åˆ—è¡¨é¡µé¢ï¼ˆsearchResult.vueï¼‰

**åŠŸèƒ½**ï¼š
- ğŸ“‹ æŸ¥çœ‹é¢„çº¦åˆ—è¡¨
- ğŸ” æ™ºèƒ½æœç´¢è½¦ç‰Œ/å§“å/æ‰‹æœºå·
- ğŸ“Š ä»Šæ—¥æ•°æ®çœ‹æ¿
- ğŸ¯ æ™ºèƒ½ç­›é€‰ï¼ˆå¾…å…¥åœº/å·²å…¥åœº/å·²ç¦»åœºï¼‰
- ğŸ“ˆ å®æ—¶ç»Ÿè®¡

**é€‚ç”¨è§’è‰²**ï¼šè®¿å®¢ã€ä¸šä¸»

### å›¾2 - è®¿å®¢é‚€è¯·é¡µé¢ï¼ˆqrcode-generator.vueï¼‰

**åŠŸèƒ½**ï¼š
- ğŸ« ç”Ÿæˆè®¿å®¢äºŒç»´ç 
- ğŸ“ å¡«å†™è®¿å®¢ä¿¡æ¯
- ğŸš— å½•å…¥è½¦ç‰Œå·ç 
- â° è®¾ç½®è®¿é—®æ—¶é—´
- ğŸ“¤ åˆ†äº«äºŒç»´ç ç»™è®¿å®¢

**é€‚ç”¨è§’è‰²**ï¼šç®¡å®¶

---

## æµ‹è¯•éªŒè¯

### æµ‹è¯•æ­¥éª¤

1. **ç®¡å®¶è§’è‰²æµ‹è¯•**
   - ä»¥ç®¡å®¶èº«ä»½ç™»å½•
   - ç‚¹å‡»åº•éƒ¨ TabBar çš„"é¢„çº¦æŸ¥è¯¢"å›¾æ ‡
   - **éªŒè¯**ï¼šåº”è¯¥è·³è½¬åˆ°è®¿å®¢é‚€è¯·é¡µé¢ï¼ˆå›¾2ï¼‰
   - **éªŒè¯**ï¼šæ˜¾ç¤ºç”ŸæˆäºŒç»´ç çš„ç•Œé¢

2. **è®¿å®¢è§’è‰²æµ‹è¯•**
   - ä»¥è®¿å®¢èº«ä»½ç™»å½•
   - ç‚¹å‡»åº•éƒ¨ TabBar çš„"é¢„çº¦æŸ¥è¯¢"å›¾æ ‡
   - **éªŒè¯**ï¼šåº”è¯¥è·³è½¬åˆ°é¢„çº¦æŸ¥è¯¢é¡µé¢ï¼ˆå›¾1ï¼‰
   - **éªŒè¯**ï¼šæ˜¾ç¤ºé¢„çº¦åˆ—è¡¨

3. **ä¸šä¸»è§’è‰²æµ‹è¯•**
   - ä»¥ä¸šä¸»èº«ä»½ç™»å½•
   - ç‚¹å‡»åº•éƒ¨ TabBar çš„"é¢„çº¦æŸ¥è¯¢"å›¾æ ‡
   - **éªŒè¯**ï¼šåº”è¯¥è·³è½¬åˆ°é¢„çº¦æŸ¥è¯¢é¡µé¢ï¼ˆå›¾1ï¼‰
   - **éªŒè¯**ï¼šæ˜¾ç¤ºé¢„çº¦åˆ—è¡¨

4. **ç›´æ¥è®¿é—®æµ‹è¯•**ï¼ˆç®¡å®¶ï¼‰
   - ä»¥ç®¡å®¶èº«ä»½
   - ç›´æ¥é€šè¿‡ URL è®¿é—® `pagesA/reservation/searchResult/searchResult`
   - **éªŒè¯**ï¼šåº”è¯¥ç«‹å³è·³è½¬åˆ° `pagesB/butler/qrcode-generator`

### æ£€æŸ¥è¦ç‚¹

- âœ… `currentUserRole` æ­£ç¡®è¯†åˆ«ä¸º `'manager'`
- âœ… TabBar è·³è½¬åˆ°æ­£ç¡®çš„é¡µé¢
- âœ… æ§åˆ¶å°æ—¥å¿—è¾“å‡ºæ­£ç¡®
- âœ… é¡µé¢æ˜¾ç¤ºç¬¦åˆé¢„æœŸ

---

## ç›¸å…³æ–‡ä»¶

1. **pagesA/reservation/searchResult/searchResult.vue**
   - `onLoad()` - ç¬¬807-825è¡Œ
   - `onShow()` - ç¬¬868-876è¡Œ

2. **components/custom-tabbar.vue**
   - `navigateToQueryPage()` - ç¬¬634-680è¡Œ

---

## æ³¨æ„äº‹é¡¹

### è§’è‰²è¯†åˆ«

ç¡®ä¿ç”¨æˆ·ç™»å½•æ—¶æ­£ç¡®è®¾ç½®äº† `userInfo.role` æˆ– `userInfo.userInfo.userkind`ï¼š

```javascript
// ç™»å½•æ—¶ä¿å­˜
uni.setStorageSync('userInfo', {
    role: 'manager',  // æˆ– 'owner', 'visitor'
    userInfo: {
        userkind: 'manager',
        username: 'å¼ ä¸‰',
        // ...
    }
});
```

### TabBar é…ç½®

`custom-tabbar.vue` ä¸­çš„ `tabBarConfigs` åº”è¯¥åŒ…å«ç®¡å®¶çš„è®¿å®¢é‚€è¯·é¡µé¢ï¼š

```javascript
tabBarConfigs: {
    manager: [
        { text: 'ä»£äººé¢„çº¦', iconPath: '...', selectedIconPath: '...', pagePath: 'pagesA/reservation/form' },
        { text: 'è®¿å®¢é‚€è¯·', iconPath: '...', selectedIconPath: '...', pagePath: 'pagesB/butler/qrcode-generator' },
        { text: 'å°åŒºç®¡ç†', iconPath: '...', selectedIconPath: '...', pagePath: 'pages/site/facility' },
        // ...
    ]
}
```

---

## ä¿®å¤æ—¥æœŸ
2025å¹´12æœˆ3æ—¥

## ä¿®å¤äººå‘˜
Cascade AI Assistant

## ç›¸å…³é—®é¢˜
- ç®¡å®¶è¿›å…¥é¢„çº¦æŸ¥è¯¢æ˜¾ç¤ºåˆ—è¡¨é¡µé¢
- TabBarè·³è½¬ä¸åŒºåˆ†è§’è‰²
- ç®¡å®¶å·¥ä½œæµç¨‹ä¼˜åŒ–
